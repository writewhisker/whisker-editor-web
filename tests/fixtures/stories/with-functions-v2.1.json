{
  "format": "whisker",
  "formatVersion": "2.1",
  "metadata": {
    "title": "Story with Functions",
    "author": "Test Suite",
    "version": "1.0.0",
    "created": "2025-10-29T00:00:00.000Z",
    "modified": "2025-10-29T00:00:00.000Z",
    "ifid": "00000000-0000-4000-8000-000000000002",
    "description": "Story with Lua functions for testing v2.1 format"
  },
  "settings": {
    "startPassage": "start",
    "scriptingLanguage": "lua"
  },
  "startPassage": "start",
  "passages": [
    {
      "id": "start",
      "name": "Start",
      "content": "Your health is {{ health }}. {{ greet(playerName) }}",
      "position": { "x": 0, "y": 0 },
      "choices": [
        {
          "id": "choice1",
          "text": "Take damage",
          "target": "damaged",
          "action": "health = health - 10"
        },
        {
          "id": "choice2",
          "text": "Heal",
          "target": "healed",
          "condition": "health < 100"
        }
      ]
    },
    {
      "id": "damaged",
      "name": "Damaged",
      "content": "You took damage! Health: {{ health }}",
      "position": { "x": -100, "y": 150 },
      "choices": [
        {
          "id": "choice3",
          "text": "Continue",
          "target": "start"
        }
      ]
    },
    {
      "id": "healed",
      "name": "Healed",
      "content": "You healed! Health: {{ health }}",
      "position": { "x": 100, "y": 150 },
      "onEnterScript": "health = 100",
      "choices": [
        {
          "id": "choice4",
          "text": "Continue",
          "target": "start"
        }
      ]
    }
  ],
  "variables": {
    "health": {
      "type": "number",
      "default": 100
    },
    "playerName": {
      "type": "string",
      "default": "Hero"
    }
  },
  "editorData": {
    "tool": {
      "name": "whisker-editor-web",
      "version": "1.0.0",
      "url": "https://github.com/writewhisker/whisker-editor-web"
    },
    "modified": "2025-10-29T00:00:00.000Z",
    "luaFunctions": {
      "greet": {
        "id": "greet",
        "name": "greet",
        "description": "Greets the player by name",
        "params": ["name"],
        "body": "return \"Hello, \" .. name .. \"!\"",
        "tags": ["utility"],
        "created": "2025-10-29T00:00:00.000Z",
        "modified": "2025-10-29T00:00:00.000Z"
      },
      "calculateDamage": {
        "id": "calculateDamage",
        "name": "calculateDamage",
        "description": "Calculates damage based on attack power",
        "params": ["power", "defense"],
        "body": "local damage = power - defense\nif damage < 0 then damage = 0 end\nreturn damage",
        "tags": ["combat", "math"],
        "created": "2025-10-29T00:00:00.000Z",
        "modified": "2025-10-29T00:00:00.000Z"
      }
    }
  }
}
